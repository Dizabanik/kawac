import stdc;

// Structs
struct User {
    u32 id;
    u8 age;
}
impl User {
    fn int add(User a, User b){
       stdc.printf("%d %d\n", a.id + b.id, a.age + b.age);
       return a.id+b.id;
    }
}
// Structs
struct Car {
    u32 speed;
    u32 accel;
}
impl Car {
    fn u32 create(Car* c){
        (*c).speed = 90 + 1;
    }
}

alias Millisecond = u32;

fn Millisecond test(Millisecond input){
    return (input + 1);
}

fn i32 main() {
    // C-Style Declarations
    u32 count = 10;
    char c = 'K';
    bool ok = true;
    Millisecond mil = 20;
    Millisecond ret = test(mil);
    User k = {0,90};
    stdc.printf("%d %d\n", k.id, k.age);
    User a;
    User b = {.id = 90, .age = 18};
    a.id = 2;
    a.age = 40;
    k.add(a,b);
    //Car* car = stdc.malloc(sizeof(Car));
    //(*car).speed = 90;
    //(*car).create(car);
    //stdc.printf("Car: %u\n", car.speed);

    stdc.printf("Char: %c, Bool: %d, Mil: %d\n", c, ok, ret);

    let x = 10;
    if(x >= 11) {
    return 42;
    }
    orbit y := x + 5;

    stdc.printf("Orbit: x=%d, y=%d\n", x, y);
    x = 50;
    stdc.printf("Orbit Updated: x=%d, y=%d\n", x, y);

    // Pour Operator
    let nums = set { 1, 2 };
    nums ~= 3;




    batch (n in nums) {
        stdc.printf("Batch: %d\n", n);
    }

    let task_handle = brew {
        i32 sum = 0;
        while (sum < 1000000) {
        sum = sum + 1;
        }
        stdc.printf("Async Done. Sum: %d\n", sum);
        return sum;
    };

    defer stdc.printf("Main working...\n");
    stdc.printf("%d\n", sip(task_handle));



    i8* ptr = stdc.malloc((u64)16);
    stdc.free(ptr);

    stdc.printf("End.\n");
}
